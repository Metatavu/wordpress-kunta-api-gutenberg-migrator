{"version":3,"file":"scripts.js","sourceRoot":"","sources":["../ts/scripts.ts"],"names":[],"mappings":"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","sourcesContent":["declare const wp: any;\n\nconst { registerBlockType } = wp.blocks;\n\ndeclare const settings: { \n  nonce: string;\n  ajaxUrl: string;\n  newsAcfField: string;\n};\n\n/**\n * Registers newsblock Gutenberg block\n */\nconst registerNewsBlock = () => {\n  registerBlockType('acf/newsblock', {\n    category: 'acf',\n    title: \"title\",\n    attributes: {\n      data: {\n        type: \"object\"\n      }\n    }\n  });\n};\n\n/**\n * Post type\n */\ntype ItemType = \"page\" | \"post\";\n\n/**\n * Interface for single item\n */\ninterface Item {\n  id: number;\n  type: ItemType;\n}\n\n/**\n * Interface for Wordpress post (or similar object, e.g. page)\n */\ninterface PostLike {\n  content: {\n    raw: string;\n  };\n}\n\n/**\n * Interface for parsed shortcode\n */\ninterface ParsedShortcode {\n  name: string;\n  attrs: { [key: string]: string };\n}\n\n/**\n * Main function\n */\n(($: JQueryStatic) => {\n  let checkedItems: Item[] = [];\n  let ids: any = {};\n\n  /**\n   * Updates the checkedIds array with the ids of the checked checkboxes.\n   */\n  const updateSelected = () => {\n    checkedItems = $('.kunta-api-migrate:checked').map((_index, element) => {\n      return JSON.parse($(element).val() as string) as Item;\n    }).get();\n\n    if (checkedItems.length) {\n      $('#kunta-api-guttenberg-migrator-migrate-button').removeAttr('disabled');\n    } else {\n      $('#kunta-api-guttenberg-migrator-migrate-button').attr('disabled', 'disabled');\n    }\n  };\n \n  /**\n   * Converts html to Gutenberg blocks\n   * \n   * @param html html\n   * @returns Gutenberg blocks\n   */\n  const convertToBlocks = (html: string): any[] => {\n    return wp.blocks.rawHandler({ \n\t\t\tHTML: html\n\t\t});\n  };\n\n  /**\n   * Resolves a service location component\n   * \n   * @param componentName component name\n   * @returns resolved name\n   */\n  const resolveServiceLocationComponent = (componentName: string) => {\n\n    switch(componentName) {\n      case \"accessibility\":\n        return \"accessibility\";\n      case \"description\":\n        return \"description\";\n      case \"addresses\":\n        return \"addresses\";\n      case \"email\":\n        return \"email\";\n      case \"name\":\n        return \"name\";\n      case \"phone\":\n        return \"phone-numbers\";\n      case \"servicehours\":\n        return \"service-hours\";\n      case \"webpages\":\n        return \"webpage\";\n      default:\n        throw Error(`Could not resolve service location component ${componentName}`);\n    }\n  }\n\n  /**\n   * Resolves a service component\n   * \n   * @param componentName component name\n   * @returns resolved name\n   */\n  const resolveServiceComponent = (componentName: string) => {\n    switch(componentName) {\n      case \"description\":\n        return \"description\";\n      case \"userInstruction\":\n        return \"user-instruction\";\n      case \"languages\":\n        return \"languages\";\n      case \"electronicServiceChannelIds\":\n        return \"electronic-service-list\";\n      case \"phoneServiceChannelIds\":\n        return \"phone-service-list\";\n      case \"printableFormServiceChannelIds\":\n        return \"printable-form-list\";\n      case \"serviceLocationServiceChannelIds\":\n        return \"service-location-list\";\n      case \"webPageServiceChannelIds\":\n        return \"webpage-service-list\";\n      default:\n        throw Error(`Could not resolve service component ${componentName}`);\n    }\n  }\n\n  /**\n   * Migrates a component\n   * \n   * @param element element to be migrated\n   * @returns migrated component\n   */\n  const migrateComponent = (element: JQuery, block: any, pageId: number) => { \n    const type = element.attr(\"data-type\");\n    const componentName = element.attr(\"data-component\");\n\n    switch (type) {\n      case \"kunta-api-service-location-component\":\n        const serviceLocationIdAttr = element.attr(\"data-service-channel-id\");\n        if (!serviceLocationIdAttr || serviceLocationIdAttr == \"undefined\") {\n          return null;\n        }\n\n        const serviceLocationId = ids[serviceLocationIdAttr];\n        if (!serviceLocationId) {\n          throw Error(`No PTV id service channel location found for Kunta id ${serviceLocationIdAttr}, for page ${pageId}`);\n        }\n\n        if (componentName === \"fax\" || componentName === \"phone-charge-info\") {\n          return null;\n        }\n\n        const newLocationComponentName = resolveServiceLocationComponent(componentName);\n        return {\n          \"name\": \"sptv/service-location-service-channel-block\",\n          \"attributes\": {\n              \"id\": serviceLocationId,\n              \"component\": newLocationComponentName,\n              \"language\": \"fi\"\n          },\n          \"innerBlocks\": [] as any[],\n          \"innerHTML\": null as string | null\n        }\n\n      case \"kunta-api-service-component\":\n        const serviceIdAttr = element.attr(\"data-service-id\");\n        if (!serviceIdAttr || serviceIdAttr == \"undefined\") {\n          return null;\n        }\n        const serviceId = ids[serviceIdAttr];\n        if (!serviceId) {\n          throw Error(`No PTV id service found for Kunta id ${serviceIdAttr}, for page ${pageId}`);\n        }\n        const newComponentName = resolveServiceComponent(componentName);\n        return {\n          \"name\": \"sptv/service-block\",\n          \"attributes\": {\n              \"id\": serviceId,\n              \"component\": newComponentName,\n              \"language\": \"fi\"\n          },\n          \"innerBlocks\": [] as any[],\n          \"innerHTML\": null as string | null\n        }\n\n      default:\n        return block;\n    }\n  }\n\n  /**\n   * Gets the JQUERY-element from a block\n   * \n   * @param block block\n   * @returns block\n   */\n  const getElement = (block: any) => {\n    try {\n      return $(block.attributes.content);\n    } catch (e) {\n      return undefined;\n    }\n  }\n\n  /**\n   * Migrates newslist shortcode\n   * \n   * @param block block\n   * @param parsedShortcode parsed shortcode \n   * @returns migrated block\n   */\n  const migrateNewsListShortcode = async (parsedShortcode: ParsedShortcode ) => {\n    const tag = parsedShortcode.attrs.tag;\n    const categoryId = await findCategoryId(tag);\n    if (!categoryId) {\n      throw new Error(`Could not find new list categry ${tag}`);\n    }\n\n    const data: { [key: string]: any } = {\n      tag: categoryId,\n      _tag: settings.newsAcfField\n    };\n  \n    return {\n      \"name\": \"acf/newsblock\",\n      \"attributes\": {\n        data: data,\n        align: \"\",\n        mode: \"auto\"\n      },\n      \"innerBlocks\": [] as any[]\n    };\n  };\n\n  /**\n   * Decodes html encoded text\n   * \n   * @param html html encoded text\n   * @returns decoded text\n   */\n  const decodeHtmlEntities = (html: string): string => {\n    const txt = document.createElement(\"textarea\");\n    txt.innerHTML = html;\n    return txt.value;\n  }\n  \n  /**\n   * Parses shortcode attributes\n   * \n   * @param text attrbutes text\n   * @returns parsed shortcode attributes \n   */\n  const parseShortcodeAttributes = (text: string): { [key: string ]: string } => {\n    const result: { [key: string ]: string } = {};\n    if (!text) {\n      return result;\n    }\n\n    let textLeft = text;\n    let match = null;\n\n    match = textLeft.match(/([a-z]{1,})=\\\"(.*?)\\\"/);\n    while (match && match.length === 3) {\n      const [ matchText, name, value ] = match;\n      result[name] = decodeHtmlEntities(value);\n\n      textLeft = textLeft.substring(matchText.length);\n      match = textLeft.match(/([a-z]{1,})=\\\"(.*?)\\\"/)\n    }\n\n    return result;\n  }\n\n  /**\n   * Parses shortcode from text representation\n   * \n   * @param text shortcode text representation\n   * @returns parsed shortcode\n   */\n  const parseShortcodeText = (text: string): ParsedShortcode | null => {\n    const result = text.match(/\\[([a-z_]{1,})(.*)\\]/);\n    if (!result) {\n      throw Error(`Could not parse shortcode ${text}`);\n    }\n\n    const name = result[1];\n    const attrs: { [key: string]: string } = parseShortcodeAttributes(result[2]);\n    \n    return {\n      name: name,\n      attrs: attrs\n    };\n  };\n\n  /**\n   * Migrates a shortcode\n   * \n   * @param block \n   * @returns \n   */\n  const migrateShortcode = async (block: any) => {\n    const shortcodeText = block?.attributes?.text;\n    if (!shortcodeText) {\n      return block;\n    }\n\n    const parsedShortcode = parseShortcodeText(shortcodeText);\n    if (!parsedShortcode) {\n      return block;\n    }\n\n    switch (parsedShortcode.name) {\n      case \"kunta_api_news_list\":\n        return await migrateNewsListShortcode(parsedShortcode);\n    }\n\n    return block;\n  };\n\n  /**\n   * Migrate block \n   * \n   * @param block block\n   * @param pageId page id\n   * @returns migrated block\n   */\n  const migrateBlock = async (block: any, pageId: number): Promise<any> => {\n    if (block.name === \"core/shortcode\") {\n      return await migrateShortcode(block);\n    }\n\n    const element = getElement(block);\n\n    if (!element) {\n      return block;\n    }\n\n    return migrateComponent(element, block, pageId);\n  };\n\n  /**\n   * Migrate blocks\n   * \n   * @param html html to migrate\n   * @param pageId page id\n   * @returns migrated blocks\n   */\n  const migrateBlocks = async (html: string, pageId: number) => {\n    const blocks = convertToBlocks(html);\n    const migratedBlocks = await Promise.all(blocks.filter(block => getElement(block)?.prop('tagName') != 'ASIDE').map(block => migrateBlock(block, pageId)));\n    return migratedBlocks.filter(block => !!block);\n  };\n\n  /**\n   * Downloads page from Wordpress API\n   * \n   * @param id page id\n   * @returns page\n   */\n  const getPage = async (id: number): Promise<PostLike> => {\n    return new Promise((resolve, reject) => {\n      $.ajax({\n        method: \"GET\",\n        beforeSend: ( xhr ) => {\n          xhr.setRequestHeader('X-WP-Nonce', settings.nonce);\n        },\n        url: `/wp-json/wp/v2/pages/${id}?context=edit`\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n  };\n\n  /**\n   * Searches categories by name\n   * \n   * @param name category name\n   * @returns found categories\n   */\n  const searchCategories = (name: string): Promise<any[]> => {\n    return new Promise((resolve, reject) => {\n      $.ajax({\n        method: \"GET\",\n        beforeSend: ( xhr ) => {\n          xhr.setRequestHeader('X-WP-Nonce', settings.nonce);\n        },\n        url: `/wp-json/wp/v2/categories?search=${name}`\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n  }\n\n  /**\n   * Finds category id for categry name\n   * \n   * @param name category name\n   * @returns found category id or null if not found\n   */\n  const findCategoryId = async (name: string) => {\n    const categories = await searchCategories(name);\n    return categories.find(category => {\n      return category.name === name;\n    })?.id;\n  }\n  \n  /**\n   * Downloads post from Wordpress API\n   * \n   * @param id post id\n   * @returns post\n   */\n  const getPost = async (id: number): Promise<PostLike> => {\n    return new Promise((resolve, reject) => {\n      $.ajax({\n        method: \"GET\",\n        beforeSend: ( xhr ) => {\n          xhr.setRequestHeader('X-WP-Nonce', settings.nonce);\n        },\n        url: `/wp-json/wp/v2/posts/${id}?context=edit`\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n  };\n\n  /**\n   * Downloads item data\n   * \n   * @param item item\n   * @returns item data\n   */\n  const getItemData = async (item: Item) => {\n    switch (item.type) {\n      case \"page\":\n        return (await getPage(item.id)).content.raw;\n      case \"post\":\n        return (await getPost(item.id)).content.raw;\n      default:\n        throw Error(`Unknown item type: ${item.type}`);\n    }\n  };\n\n  /**\n   * Updates migrated item back to Wordpress\n   * \n   * @param item item\n   * @param migratedHtml migrated html\n   */\n  const updateItem = async (item: Item, migratedHtml: string) => {\n    return new Promise((resolve, reject) => {\n      const { ajaxUrl, nonce } = settings;\n\n      $.ajax({\n        method: \"POST\",\n        url: ajaxUrl,\n        data: { \n          action : \"kunta_api_guttenberg_migrator_migrate_item\", \n          _wpnonce : nonce, \n          item: JSON.stringify(item),\n          migratedHtml: migratedHtml \n        }\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n  };\n\n  /**\n   * Scans the database for items that need to be migrated.\n   */\n  const scanItems = async () => {\n    return new Promise((resolve, reject) => {\n      const { ajaxUrl, nonce } = settings;\n\n      $.ajax({\n        method: \"POST\",\n        url: ajaxUrl,\n        data: { \n          action : \"kunta_api_guttenberg_migrator_scan_items\", \n          _wpnonce : nonce\n        }\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n  };\n\n  /**\n   * Loads the id map\n   */\n  const loadIdMap = async () => {\n    return new Promise((resolve, reject) => {\n      const { ajaxUrl, nonce } = settings;\n\n      $.ajax({\n        method: \"POST\",\n        url: ajaxUrl,\n        data: { \n          action : \"kunta_api_guttenberg_migrator_load_id_map\", \n          _wpnonce : nonce\n        }\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n   };\n\n  /**\n   * Load post sidebar\n   * @param postId post id\n   */\n  const loadPostSidebar = async (postId: number) => {\n    return new Promise((resolve, reject) => {\n      const { ajaxUrl, nonce } = settings;\n\n      $.ajax({\n        method: \"POST\",\n        url: ajaxUrl,\n        data: { \n          action : \"kunta_api_guttenberg_migrator_load_post_sidebar\",\n          post_id : postId, \n          _wpnonce : nonce\n        }\n      })\n      .done(resolve)\n      .fail(reject);\n    });\n };\n\n  /**\n   * Migrates single item\n   * \n   * @param item item to be migrated\n   */\n  const migrateItem = async (item: Item) => {\n    try {\n      const itemData = await getItemData(item);\n      const migratedMainContent = await migrateBlocks(itemData, item.id);\n      \n      const featuredImage = {\n        \"name\": \"core/post-featured-image\",\n        \"attributes\": { },\n        \"innerBlocks\": [ ] as any[]\n      };\n      \n      const postTitle = {\n        \"name\": \"core/post-title\",\n        \"attributes\": { \n          level: 1\n        },\n        \"innerBlocks\": [ ] as any[]\n      };\n\n      const sidebar = await loadPostSidebar(item.id);\n  \n      if (sidebar) {\n        const migratedSidebar = await migrateBlocks(sidebar as string, item.id);\n        const mainContentWithSidebar = {\n          \"name\": \"core/columns\",\n          \"attributes\": {\n            \"isStackedOnMobile\": true\n          },\n          \"innerBlocks\": [{\n            \"name\": \"core/column\",\n            \"attributes\": {\n              \"width\": \"66.66%\"\n            },\n            \"innerBlocks\": [ postTitle, featuredImage, ... migratedMainContent ]\n          },\n          {\n            \"name\": \"core/column\",\n            \"attributes\": {\n              \"width\": \"33.33%\"\n            },\n            \"innerBlocks\": migratedSidebar\n          }]\n        };\n        \n        const migratedHtml = wp.blocks.serialize(mainContentWithSidebar);\n\n        await updateItem(item, migratedHtml);\n      } else {\n        const migratedHtml = wp.blocks.serialize([ featuredImage, ... migratedMainContent ]);\n        await updateItem(item, migratedHtml);\n      }\n    } catch (error: any) {\n      console.log(error);\n    }\n  };\n\n  wp.domReady(async () => {\n    $('<div />')\n      .attr('id', 'kunta-api-guttenberg-migrator-editor')\n      .attr('style', 'display: block')\n      .prependTo(document.body);\n\n    ids = await loadIdMap();\n    ids = JSON.parse(ids);\n    wp.editPost.initializeEditor('kunta-api-guttenberg-migrator-editor', null, null, { defaultEditorStyles: [ ] }, {});\n    updateSelected();\n  });\n\n  $('.kunta-api-migrate').on(\"change\", () => {\n    updateSelected();\n  });\n\n  $('#kunta-api-guttenberg-migrator-migrate-button').on(\"click\", async () => {\n    registerNewsBlock();\n    $('#kunta-api-guttenberg-migrator-migrate-button').attr(\"disabled\", \"disabled\");\n    await Promise.all(checkedItems.map(migrateItem));\n    window.location.reload();\n  });\n\n  $('#kunta-api-guttenberg-migrator-scan-button').on(\"click\", async () => {\n    await scanItems();\n    window.location.reload();\n  });\n\n  $('.kunta-api-migrate-all').on(\"change\", async (event) => {\n    const value = (event.target as HTMLInputElement).checked;\n    $('.kunta-api-migrate').map((_index, element) => {\n      (element as HTMLInputElement).checked = value;\n    });\n\n    $('.kunta-api-migrate-all').map((_index, element) => {\n      (element as HTMLInputElement).checked = value;\n    });\n    \n    updateSelected();\n  });\n\n})(jQuery);\n"]}